# SEO редиректы для переименованных станиц

Суть метода - говорим nginx'у вместо статичной 404 страницы использовать специальный локейшен
```
error_page 404 = @fallback;
```

В этом локейшене делаем проксирование на бэкенд, на специальный эндпоинт, который ищет в БД
редирект для текущей страницы.
```
location @fallback {
    root /var/www;

    fastcgi_pass   php:9000;
    fastcgi_index  redirect-after-404.php;
    fastcgi_param  SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
    include        fastcgi_params;
    
    # Указываем эндпоинт, который должен вернуть редирект
    fastcgi_param  REQUEST_URI /search-redirect;
    # передаём ему uri для которого нужно найти редирект
    fastcgi_param  OLD_URI $request_uri;
}
```
Найдя редирект, бэкенд вернёт нужный код и заголовок.  
А если не найдёт, то вернёт 404.

Такой подход позволяет управлять редиректами через приложение, хранить их в БД,
и главное - не добавляет оверхеда для нормальных страниц, потому что поиск редиректа просиходит
только если мы уже получили 404.